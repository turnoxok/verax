<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta CEA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { 
    font-family: Arial, sans-serif; 
    background: #f5f5f5; 
    display: flex; 
    justify-content: center; 
    align-items: flex-start; 
    padding-top: 50px;
  }
  #container { 
    background: #fff; 
    padding: 20px; 
    border-radius: 10px; 
    box-shadow: 0 0 10px #ccc; 
    width: 400px; 
  }
  input, button { 
    width: 100%; 
    padding: 10px; 
    margin-top: 10px; 
    border-radius: 5px; 
    border: 1px solid #ccc; 
    font-size: 16px;
  }
  button { 
    background: #533482; 
    color: #fff; 
    border: none; 
    cursor: pointer; 
  }
  button:disabled { 
    background: #aaa; 
    cursor: not-allowed; 
  }
  #iframeContainer {
    margin-top: 20px;
    width: 100%;
    height: 500px;
    border: 1px solid #ccc;
  }
  iframe { width: 100%; height: 100%; border: none; }
</style>
</head>
<body>

<div id="container">
  <h3>Consulta tu Informe CEA</h3>
  <input type="text" id="dni" placeholder="Ingresá tu DNI" maxlength="8">
  <button id="verInforme" disabled>Ver Informe</button>
  <div id="iframeContainer">
    <iframe id="ceaIframe"></iframe>
  </div>
</div>

<script>
const dniInput = document.getElementById('dni');
const verBtn = document.getElementById('verInforme');
const ceaIframe = document.getElementById('ceaIframe');

dniInput.addEventListener('input', () => {
  verBtn.disabled = !/^\d{7,8}$/.test(dniInput.value);
});

verBtn.addEventListener('click', async () => {
  const dni = dniInput.value;
  if (!dni) return;

  try {
    // Genera un token temporal desde tu función serverless
    const res = await fetch('/.netlify/functions/generateToken', { method: 'POST' });
    const data = await res.json();
    const token = data.token;

    // Carga el informe en el iframe en la misma página
    ceaIframe.src = `/openCEA?token=${token}&dni=${dni}`;
  } catch (err) {
    alert('Error al generar el informe. Probá nuevamente más tarde.');
    console.error(err);
  }
});
</script>

</body>
</html>
